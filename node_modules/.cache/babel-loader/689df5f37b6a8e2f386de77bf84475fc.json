{"ast":null,"code":"import { chatConstants } from \"../constants/chat.constants\";\nimport { chatService } from \"../services/chat.service\";\nexport function chat(state = {\n  rooms: [],\n  currentRoom: null,\n  roomsFetching: false,\n  roomId: null,\n  callingModal: false,\n  answeringModal: {\n    isOpen: false\n  },\n  searchedRooms: null\n}, action) {\n  switch (action.type) {\n    case chatConstants.TYPING:\n      if (state[action.roomId]) {\n        return { ...state,\n          [action.roomId]: { ...state[action.roomId],\n            isTyping: true\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.STOPPED_TYPING:\n      if (state[action.roomId]) {\n        return { ...state,\n          [action.roomId]: { ...state[action.roomId],\n            isTyping: false\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.CHANGE_ROOM:\n      if (action.clearRoom != null && action.clearRoom != action.room._id) state[action.clearRoom].messages = [];\n      return { ...state,\n        currentRoom: action.room,\n        roomId: action.room._id\n      };\n\n    case chatConstants.INIT_MESSAGE_ARRAY:\n      if (!state[action.roomId]) {\n        return { ...state,\n          [action.roomId]: {\n            messages: [],\n            initialMessagesFetchig: false,\n            messageFetching: false,\n            isTyping: false\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.GET_ROOMS_REQUEST:\n      return { ...state,\n        roomsFetching: true\n      };\n\n    case chatConstants.GET_ROOMS_SUCCESS:\n      return { ...state,\n        rooms: action.rooms,\n        roomsFetching: false\n      };\n\n    case chatConstants.ADD_NEW_ROOM:\n      return { ...state,\n        rooms: [action.room, ...state.rooms]\n      };\n\n    case chatConstants.GET_MESSAGES_INITIAL_REQUEST:\n      return { ...state,\n        [action.roomId]: { ...state[action.roomId],\n          initialMessagesFetchig: true\n        }\n      };\n\n    case chatConstants.GET_MESSAGES_REQUEST:\n      return { ...state,\n        [action.roomId]: { ...state[action.roomId],\n          messageFetching: true\n        }\n      };\n\n    case chatConstants.GET_MESSAGES_SUCCESS:\n      let messages = action.data.messages;\n      let prev = null;\n\n      for (let i = 0; i < messages.length; i++) {\n        if (prev !== messages[i].sender) {\n          messages[i].picture = true;\n          prev = messages[i].sender;\n        } else {\n          messages[i].picture = false;\n        }\n      }\n\n      return { ...state,\n        [action.data.roomId]: { ...state[action.data.roomId],\n          messages: [...action.data.messages, ...state[action.data.roomId].messages],\n          messageFetching: false,\n          initialMessagesFetchig: false\n        }\n      };\n\n    case chatConstants.SEND_MESSAGE_REQUEST:\n      let currentRoom = state.currentRoom;\n\n      if (currentRoom && state.currentRoom._id === action.message.roomId) {\n        currentRoom = { ...state.currentRoom,\n          messages: state.currentRoom.messages + 1\n        };\n      }\n\n      if (state[action.message.roomId]) {\n        const messages = state[action.message.roomId].messages;\n        if (!messages.length) action.message.picture = true;else if (messages[messages.length - 1].sender !== action.message.sender) action.message.picture = true;else action.message.picture = false;\n        console.log(state[action.message.roomId].messages);\n        return { ...state,\n          [action.message.roomId]: { ...state[action.message.roomId],\n            messages: [...state[action.message.roomId].messages, action.message]\n          },\n          rooms: state.rooms.map(room => {\n            if (room._id === action.message.roomId) {\n              return { ...room,\n                messages: room.messages + 1\n              };\n            } else {\n              return room;\n            }\n          }),\n          currentRoom\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.SEND_MESSAGE_SUCCESS:\n      if (state[action.message.roomId]) {\n        const index = state.rooms.findIndex(room => room._id === action.message.roomId);\n        const newRoom = state.rooms[index];\n        const messages = state[action.message.roomId].messages;\n        if (messages.length <= 1) action.message.picture = true;else if (messages[messages.length - 2].sender !== action.message.sender) action.message.picture = true;else action.message.picture = false;\n        return { ...state,\n          [action.message.roomId]: { ...state[action.message.roomId],\n            messages: state[action.message.roomId].messages.map(message => {\n              if (message.uuid !== action.message.uuid) {\n                return action.message;\n              } else {\n                return message;\n              }\n            })\n          },\n          rooms: [{ ...newRoom,\n            //messages: newRoom.messages + 1,\n            lastMessage: action.message\n          }, ...state.rooms.filter(room => room._id !== action.message.roomId)]\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.NEW_MESSAGE:\n      if (state[action.message.roomId]) {\n        const index = state.rooms.findIndex(room => room._id === action.message.roomId);\n        const newRoom = state.rooms[index];\n        const messages = state[action.message.roomId].messages;\n        if (!messages.length) action.message.picture = true;else if (messages[messages.length - 1].sender !== action.message.sender) action.message.picture = true;else action.message.picture = false;\n        let currentRoom = state.currentRoom;\n\n        if (currentRoom && state.currentRoom._id !== action.message.roomId) {\n          chatService.readMessages({\n            roomId: action.message.roomId,\n            messageIds: [action.message._id]\n          });\n          currentRoom = { ...state.currentRoom,\n            messages: state.currentRoom.messages + 1\n          };\n        } else {\n          action.message.read = true;\n        }\n\n        return { ...state,\n          [action.message.roomId]: { ...state[action.message.roomId],\n            messages: [...state[action.message.roomId].messages, action.message]\n          },\n          currentRoom,\n          rooms: [{ ...newRoom,\n            messages: newRoom.messages + 1,\n            lastMessage: action.message\n          }, ...state.rooms.filter(room => room._id !== action.message.roomId)]\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.READ_MESSAGES:\n      return { ...state,\n        [action.roomId]: { ...state[action.roomId],\n          messages: state[action.roomId].messages.map(message => {\n            if (action.messageIds.includes(message._id)) {\n              return { ...message,\n                read: true\n              };\n            } else {\n              return { ...message\n              };\n            }\n          })\n        }\n      };\n\n    case chatConstants.CHANGE_ACTIVITY_STATUS:\n      return { ...state,\n        rooms: state.rooms.map(room => {\n          if (room.members[0]._id === action.user.user) {\n            room.members[0].active = action.user.active;\n            return { ...room\n            };\n          } else if (room.members[1]._id === action.user.user) {\n            room.members[1].active = action.user.active;\n            return { ...room\n            };\n          } else {\n            return { ...room\n            };\n          }\n        })\n      };\n\n    case chatConstants.RECEIVE_READ_MESSAGES:\n      if (state[action.data.roomId]) {\n        return { ...state,\n          [action.data.roomId]: { ...state[action.data.roomId],\n            messages: state[action.data.roomId].messages.map(message => {\n              if (action.data.messageIds.includes(message._id)) {\n                return { ...message,\n                  read: true\n                };\n              } else {\n                return { ...message\n                };\n              }\n            })\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.OPEN_CALLING_MODAL:\n      return { ...state,\n        callingModal: true\n      };\n\n    case chatConstants.CLOSE_CALLING_MODAL:\n      return { ...state,\n        callingModal: false\n      };\n\n    case chatConstants.OPEN_ANSWERING_MODAL:\n      return { ...state,\n        answeringModal: { ...state.answeringModal,\n          isOpen: true,\n          webRtc: { ...state.webRtc,\n            ...action.data.webRtc\n          },\n          caller: { ...state.caller,\n            ...action.data.caller\n          },\n          room: { ...state.room,\n            ...action.data.room\n          }\n        }\n      };\n\n    case chatConstants.CLOSE_ANSWERING_MODAL:\n      return { ...state,\n        answeringModal: { ...state.answeringModal,\n          isOpen: false,\n          webRtc: {},\n          caller: {},\n          room: {}\n        }\n      };\n\n    case chatConstants.SEARCH_USERS:\n      return { ...state,\n        searchedRooms: action.rooms\n      };\n\n    default:\n      return state;\n  }\n}","map":{"version":3,"sources":["D:/LVTN/LVTN/cuisine-net/src/reducers/chat.reducer.js"],"names":["chatConstants","chatService","chat","state","rooms","currentRoom","roomsFetching","roomId","callingModal","answeringModal","isOpen","searchedRooms","action","type","TYPING","isTyping","STOPPED_TYPING","CHANGE_ROOM","clearRoom","room","_id","messages","INIT_MESSAGE_ARRAY","initialMessagesFetchig","messageFetching","GET_ROOMS_REQUEST","GET_ROOMS_SUCCESS","ADD_NEW_ROOM","GET_MESSAGES_INITIAL_REQUEST","GET_MESSAGES_REQUEST","GET_MESSAGES_SUCCESS","data","prev","i","length","sender","picture","SEND_MESSAGE_REQUEST","message","console","log","map","SEND_MESSAGE_SUCCESS","index","findIndex","newRoom","uuid","lastMessage","filter","NEW_MESSAGE","readMessages","messageIds","read","READ_MESSAGES","includes","CHANGE_ACTIVITY_STATUS","members","user","active","RECEIVE_READ_MESSAGES","OPEN_CALLING_MODAL","CLOSE_CALLING_MODAL","OPEN_ANSWERING_MODAL","webRtc","caller","CLOSE_ANSWERING_MODAL","SEARCH_USERS"],"mappings":"AAAA,SAASA,aAAT,QAA8B,6BAA9B;AACA,SAASC,WAAT,QAA4B,0BAA5B;AAEA,OAAO,SAASC,IAAT,CACLC,KAAK,GAAG;AACNC,EAAAA,KAAK,EAAE,EADD;AAENC,EAAAA,WAAW,EAAE,IAFP;AAGNC,EAAAA,aAAa,EAAE,KAHT;AAINC,EAAAA,MAAM,EAAE,IAJF;AAKNC,EAAAA,YAAY,EAAE,KALR;AAMNC,EAAAA,cAAc,EAAE;AACdC,IAAAA,MAAM,EAAE;AADM,GANV;AASNC,EAAAA,aAAa,EAAE;AATT,CADH,EAYLC,MAZK,EAaL;AACA,UAAQA,MAAM,CAACC,IAAf;AACE,SAAKb,aAAa,CAACc,MAAnB;AACE,UAAIX,KAAK,CAACS,MAAM,CAACL,MAAR,CAAT,EAA0B;AACxB,eAAO,EACL,GAAGJ,KADE;AAEL,WAACS,MAAM,CAACL,MAAR,GAAiB,EACf,GAAGJ,KAAK,CAACS,MAAM,CAACL,MAAR,CADO;AAEfQ,YAAAA,QAAQ,EAAE;AAFK;AAFZ,SAAP;AAOD,OARD,MAQO;AACL,eAAO,EACL,GAAGZ;AADE,SAAP;AAGD;;AACH,SAAKH,aAAa,CAACgB,cAAnB;AACE,UAAIb,KAAK,CAACS,MAAM,CAACL,MAAR,CAAT,EAA0B;AACxB,eAAO,EACL,GAAGJ,KADE;AAEL,WAACS,MAAM,CAACL,MAAR,GAAiB,EACf,GAAGJ,KAAK,CAACS,MAAM,CAACL,MAAR,CADO;AAEfQ,YAAAA,QAAQ,EAAE;AAFK;AAFZ,SAAP;AAOD,OARD,MAQO;AACL,eAAO,EACL,GAAGZ;AADE,SAAP;AAGD;;AACH,SAAKH,aAAa,CAACiB,WAAnB;AACE,UAAIL,MAAM,CAACM,SAAP,IAAoB,IAApB,IAA4BN,MAAM,CAACM,SAAP,IAAoBN,MAAM,CAACO,IAAP,CAAYC,GAAhE,EAAqEjB,KAAK,CAACS,MAAM,CAACM,SAAR,CAAL,CAAwBG,QAAxB,GAAmC,EAAnC;AAErE,aAAO,EACL,GAAGlB,KADE;AAELE,QAAAA,WAAW,EAAEO,MAAM,CAACO,IAFf;AAGLZ,QAAAA,MAAM,EAAEK,MAAM,CAACO,IAAP,CAAYC;AAHf,OAAP;;AAKF,SAAKpB,aAAa,CAACsB,kBAAnB;AACE,UAAI,CAACnB,KAAK,CAACS,MAAM,CAACL,MAAR,CAAV,EAA2B;AACzB,eAAO,EACL,GAAGJ,KADE;AAEL,WAACS,MAAM,CAACL,MAAR,GAAiB;AACfc,YAAAA,QAAQ,EAAE,EADK;AAEfE,YAAAA,sBAAsB,EAAE,KAFT;AAGfC,YAAAA,eAAe,EAAE,KAHF;AAIfT,YAAAA,QAAQ,EAAE;AAJK;AAFZ,SAAP;AASD,OAVD,MAUO;AACL,eAAO,EACL,GAAGZ;AADE,SAAP;AAGD;;AAEH,SAAKH,aAAa,CAACyB,iBAAnB;AACE,aAAO,EACL,GAAGtB,KADE;AAELG,QAAAA,aAAa,EAAE;AAFV,OAAP;;AAIF,SAAKN,aAAa,CAAC0B,iBAAnB;AACE,aAAO,EACL,GAAGvB,KADE;AAELC,QAAAA,KAAK,EAAEQ,MAAM,CAACR,KAFT;AAGLE,QAAAA,aAAa,EAAE;AAHV,OAAP;;AAKF,SAAKN,aAAa,CAAC2B,YAAnB;AACE,aAAO,EACL,GAAGxB,KADE;AAELC,QAAAA,KAAK,EAAE,CAACQ,MAAM,CAACO,IAAR,EAAc,GAAGhB,KAAK,CAACC,KAAvB;AAFF,OAAP;;AAIF,SAAKJ,aAAa,CAAC4B,4BAAnB;AACE,aAAO,EACL,GAAGzB,KADE;AAEL,SAACS,MAAM,CAACL,MAAR,GAAiB,EACf,GAAGJ,KAAK,CAACS,MAAM,CAACL,MAAR,CADO;AAEfgB,UAAAA,sBAAsB,EAAE;AAFT;AAFZ,OAAP;;AAOF,SAAKvB,aAAa,CAAC6B,oBAAnB;AACE,aAAO,EACL,GAAG1B,KADE;AAEL,SAACS,MAAM,CAACL,MAAR,GAAiB,EACf,GAAGJ,KAAK,CAACS,MAAM,CAACL,MAAR,CADO;AAEfiB,UAAAA,eAAe,EAAE;AAFF;AAFZ,OAAP;;AAOF,SAAKxB,aAAa,CAAC8B,oBAAnB;AACE,UAAIT,QAAQ,GAAGT,MAAM,CAACmB,IAAP,CAAYV,QAA3B;AACA,UAAIW,IAAI,GAAG,IAAX;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,QAAQ,CAACa,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACxC,YAAID,IAAI,KAAKX,QAAQ,CAACY,CAAD,CAAR,CAAYE,MAAzB,EAAiC;AAC/Bd,UAAAA,QAAQ,CAACY,CAAD,CAAR,CAAYG,OAAZ,GAAsB,IAAtB;AACAJ,UAAAA,IAAI,GAAGX,QAAQ,CAACY,CAAD,CAAR,CAAYE,MAAnB;AACD,SAHD,MAGO;AACLd,UAAAA,QAAQ,CAACY,CAAD,CAAR,CAAYG,OAAZ,GAAsB,KAAtB;AACD;AACF;;AAED,aAAO,EACL,GAAGjC,KADE;AAEL,SAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,GAAsB,EACpB,GAAGJ,KAAK,CAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,CADY;AAEpBc,UAAAA,QAAQ,EAAE,CACR,GAAGT,MAAM,CAACmB,IAAP,CAAYV,QADP,EAER,GAAGlB,KAAK,CAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,CAAL,CAA0Bc,QAFrB,CAFU;AAMpBG,UAAAA,eAAe,EAAE,KANG;AAOpBD,UAAAA,sBAAsB,EAAE;AAPJ;AAFjB,OAAP;;AAYF,SAAKvB,aAAa,CAACqC,oBAAnB;AACE,UAAIhC,WAAW,GAAGF,KAAK,CAACE,WAAxB;;AACA,UAAIA,WAAW,IAAIF,KAAK,CAACE,WAAN,CAAkBe,GAAlB,KAA0BR,MAAM,CAAC0B,OAAP,CAAe/B,MAA5D,EAAoE;AAClEF,QAAAA,WAAW,GAAG,EACZ,GAAGF,KAAK,CAACE,WADG;AAEZgB,UAAAA,QAAQ,EAAElB,KAAK,CAACE,WAAN,CAAkBgB,QAAlB,GAA6B;AAF3B,SAAd;AAID;;AAED,UAAIlB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAT,EAAkC;AAChC,cAAMc,QAAQ,GAAGlB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QAA9C;AACA,YAAI,CAACA,QAAQ,CAACa,MAAd,EAAsBtB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,IAAzB,CAAtB,KACK,IAAIf,QAAQ,CAACA,QAAQ,CAACa,MAAT,GAAkB,CAAnB,CAAR,CAA8BC,MAA9B,KAAyCvB,MAAM,CAAC0B,OAAP,CAAeH,MAA5D,EACHvB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,IAAzB,CADG,KAEAxB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,KAAzB;AACLG,QAAAA,OAAO,CAACC,GAAR,CAAYrC,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QAAzC;AACA,eAAO,EACL,GAAGlB,KADE;AAEL,WAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,GAAyB,EACvB,GAAGJ,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CADe;AAEvBc,YAAAA,QAAQ,EAAE,CACR,GAAGlB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QADxB,EAERT,MAAM,CAAC0B,OAFC;AAFa,WAFpB;AASLlC,UAAAA,KAAK,EAAED,KAAK,CAACC,KAAN,CAAYqC,GAAZ,CAAiBtB,IAAD,IAAU;AAC/B,gBAAIA,IAAI,CAACC,GAAL,KAAaR,MAAM,CAAC0B,OAAP,CAAe/B,MAAhC,EAAwC;AACtC,qBAAO,EACL,GAAGY,IADE;AAELE,gBAAAA,QAAQ,EAAEF,IAAI,CAACE,QAAL,GAAgB;AAFrB,eAAP;AAID,aALD,MAKO;AACL,qBAAOF,IAAP;AACD;AACF,WATM,CATF;AAmBLd,UAAAA;AAnBK,SAAP;AAqBD,OA5BD,MA4BO;AACL,eAAO,EACL,GAAGF;AADE,SAAP;AAGD;;AACH,SAAKH,aAAa,CAAC0C,oBAAnB;AACE,UAAIvC,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAT,EAAkC;AAChC,cAAMoC,KAAK,GAAGxC,KAAK,CAACC,KAAN,CAAYwC,SAAZ,CACXzB,IAAD,IAAUA,IAAI,CAACC,GAAL,KAAaR,MAAM,CAAC0B,OAAP,CAAe/B,MAD1B,CAAd;AAGA,cAAMsC,OAAO,GAAG1C,KAAK,CAACC,KAAN,CAAYuC,KAAZ,CAAhB;AAEA,cAAMtB,QAAQ,GAAGlB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QAA9C;AACA,YAAIA,QAAQ,CAACa,MAAT,IAAmB,CAAvB,EAA0BtB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,IAAzB,CAA1B,KACK,IAAIf,QAAQ,CAACA,QAAQ,CAACa,MAAT,GAAkB,CAAnB,CAAR,CAA8BC,MAA9B,KAAyCvB,MAAM,CAAC0B,OAAP,CAAeH,MAA5D,EACHvB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,IAAzB,CADG,KAEAxB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,KAAzB;AAEL,eAAO,EACL,GAAGjC,KADE;AAEL,WAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,GAAyB,EACvB,GAAGJ,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CADe;AAEvBc,YAAAA,QAAQ,EAAElB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QAA7B,CAAsCoB,GAAtC,CAA2CH,OAAD,IAAa;AAC/D,kBAAIA,OAAO,CAACQ,IAAR,KAAiBlC,MAAM,CAAC0B,OAAP,CAAeQ,IAApC,EAA0C;AACxC,uBAAOlC,MAAM,CAAC0B,OAAd;AACD,eAFD,MAEO;AACL,uBAAOA,OAAP;AACD;AACF,aANS;AAFa,WAFpB;AAYLlC,UAAAA,KAAK,EAAE,CACL,EACE,GAAGyC,OADL;AAEE;AACAE,YAAAA,WAAW,EAAEnC,MAAM,CAAC0B;AAHtB,WADK,EAML,GAAGnC,KAAK,CAACC,KAAN,CAAY4C,MAAZ,CAAoB7B,IAAD,IAAUA,IAAI,CAACC,GAAL,KAAaR,MAAM,CAAC0B,OAAP,CAAe/B,MAAzD,CANE;AAZF,SAAP;AAqBD,OAjCD,MAiCO;AACL,eAAO,EACL,GAAGJ;AADE,SAAP;AAGD;;AACH,SAAKH,aAAa,CAACiD,WAAnB;AACE,UAAI9C,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAT,EAAkC;AAChC,cAAMoC,KAAK,GAAGxC,KAAK,CAACC,KAAN,CAAYwC,SAAZ,CACXzB,IAAD,IAAUA,IAAI,CAACC,GAAL,KAAaR,MAAM,CAAC0B,OAAP,CAAe/B,MAD1B,CAAd;AAGA,cAAMsC,OAAO,GAAG1C,KAAK,CAACC,KAAN,CAAYuC,KAAZ,CAAhB;AAEA,cAAMtB,QAAQ,GAAGlB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QAA9C;AACA,YAAI,CAACA,QAAQ,CAACa,MAAd,EAAsBtB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,IAAzB,CAAtB,KACK,IAAIf,QAAQ,CAACA,QAAQ,CAACa,MAAT,GAAkB,CAAnB,CAAR,CAA8BC,MAA9B,KAAyCvB,MAAM,CAAC0B,OAAP,CAAeH,MAA5D,EACHvB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,IAAzB,CADG,KAEAxB,MAAM,CAAC0B,OAAP,CAAeF,OAAf,GAAyB,KAAzB;AAEL,YAAI/B,WAAW,GAAGF,KAAK,CAACE,WAAxB;;AACA,YAAIA,WAAW,IAAIF,KAAK,CAACE,WAAN,CAAkBe,GAAlB,KAA0BR,MAAM,CAAC0B,OAAP,CAAe/B,MAA5D,EAAoE;AAClEN,UAAAA,WAAW,CAACiD,YAAZ,CAAyB;AAAE3C,YAAAA,MAAM,EAAEK,MAAM,CAAC0B,OAAP,CAAe/B,MAAzB;AAAiC4C,YAAAA,UAAU,EAAE,CAACvC,MAAM,CAAC0B,OAAP,CAAelB,GAAhB;AAA7C,WAAzB;AACAf,UAAAA,WAAW,GAAG,EACZ,GAAGF,KAAK,CAACE,WADG;AAEZgB,YAAAA,QAAQ,EAAElB,KAAK,CAACE,WAAN,CAAkBgB,QAAlB,GAA6B;AAF3B,WAAd;AAID,SAND,MAMO;AACLT,UAAAA,MAAM,CAAC0B,OAAP,CAAec,IAAf,GAAsB,IAAtB;AACD;;AACD,eAAO,EACL,GAAGjD,KADE;AAEL,WAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,GAAyB,EACvB,GAAGJ,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CADe;AAEvBc,YAAAA,QAAQ,EAAE,CACR,GAAGlB,KAAK,CAACS,MAAM,CAAC0B,OAAP,CAAe/B,MAAhB,CAAL,CAA6Bc,QADxB,EAERT,MAAM,CAAC0B,OAFC;AAFa,WAFpB;AASLjC,UAAAA,WATK;AAULD,UAAAA,KAAK,EAAE,CACL,EACE,GAAGyC,OADL;AAEExB,YAAAA,QAAQ,EAAEwB,OAAO,CAACxB,QAAR,GAAmB,CAF/B;AAGE0B,YAAAA,WAAW,EAAEnC,MAAM,CAAC0B;AAHtB,WADK,EAML,GAAGnC,KAAK,CAACC,KAAN,CAAY4C,MAAZ,CAAoB7B,IAAD,IAAUA,IAAI,CAACC,GAAL,KAAaR,MAAM,CAAC0B,OAAP,CAAe/B,MAAzD,CANE;AAVF,SAAP;AAmBD,OAzCD,MAyCO;AACL,eAAO,EACL,GAAGJ;AADE,SAAP;AAGD;;AACH,SAAKH,aAAa,CAACqD,aAAnB;AACE,aAAO,EACL,GAAGlD,KADE;AAEL,SAACS,MAAM,CAACL,MAAR,GAAiB,EACf,GAAGJ,KAAK,CAACS,MAAM,CAACL,MAAR,CADO;AAEfc,UAAAA,QAAQ,EAAElB,KAAK,CAACS,MAAM,CAACL,MAAR,CAAL,CAAqBc,QAArB,CAA8BoB,GAA9B,CAAmCH,OAAD,IAAa;AACvD,gBAAI1B,MAAM,CAACuC,UAAP,CAAkBG,QAAlB,CAA2BhB,OAAO,CAAClB,GAAnC,CAAJ,EAA6C;AAC3C,qBAAO,EACL,GAAGkB,OADE;AAELc,gBAAAA,IAAI,EAAE;AAFD,eAAP;AAID,aALD,MAKO;AACL,qBAAO,EACL,GAAGd;AADE,eAAP;AAGD;AACF,WAXS;AAFK;AAFZ,OAAP;;AAkBF,SAAKtC,aAAa,CAACuD,sBAAnB;AACE,aAAO,EACL,GAAGpD,KADE;AAELC,QAAAA,KAAK,EAAED,KAAK,CAACC,KAAN,CAAYqC,GAAZ,CAAiBtB,IAAD,IAAU;AAC/B,cAAIA,IAAI,CAACqC,OAAL,CAAa,CAAb,EAAgBpC,GAAhB,KAAwBR,MAAM,CAAC6C,IAAP,CAAYA,IAAxC,EAA8C;AAC5CtC,YAAAA,IAAI,CAACqC,OAAL,CAAa,CAAb,EAAgBE,MAAhB,GAAyB9C,MAAM,CAAC6C,IAAP,CAAYC,MAArC;AACA,mBAAO,EACL,GAAGvC;AADE,aAAP;AAGD,WALD,MAKO,IAAIA,IAAI,CAACqC,OAAL,CAAa,CAAb,EAAgBpC,GAAhB,KAAwBR,MAAM,CAAC6C,IAAP,CAAYA,IAAxC,EAA8C;AACnDtC,YAAAA,IAAI,CAACqC,OAAL,CAAa,CAAb,EAAgBE,MAAhB,GAAyB9C,MAAM,CAAC6C,IAAP,CAAYC,MAArC;AACA,mBAAO,EACL,GAAGvC;AADE,aAAP;AAGD,WALM,MAKA;AACL,mBAAO,EACL,GAAGA;AADE,aAAP;AAGD;AACF,SAhBM;AAFF,OAAP;;AAoBF,SAAKnB,aAAa,CAAC2D,qBAAnB;AACE,UAAIxD,KAAK,CAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,CAAT,EAA+B;AAC7B,eAAO,EACL,GAAGJ,KADE;AAEL,WAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,GAAsB,EACpB,GAAGJ,KAAK,CAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,CADY;AAEpBc,YAAAA,QAAQ,EAAElB,KAAK,CAACS,MAAM,CAACmB,IAAP,CAAYxB,MAAb,CAAL,CAA0Bc,QAA1B,CAAmCoB,GAAnC,CAAwCH,OAAD,IAAa;AAC5D,kBAAI1B,MAAM,CAACmB,IAAP,CAAYoB,UAAZ,CAAuBG,QAAvB,CAAgChB,OAAO,CAAClB,GAAxC,CAAJ,EAAkD;AAChD,uBAAO,EACL,GAAGkB,OADE;AAELc,kBAAAA,IAAI,EAAE;AAFD,iBAAP;AAID,eALD,MAKO;AACL,uBAAO,EACL,GAAGd;AADE,iBAAP;AAGD;AACF,aAXS;AAFU;AAFjB,SAAP;AAkBD,OAnBD,MAmBO;AACL,eAAO,EACL,GAAGnC;AADE,SAAP;AAGD;;AACH,SAAKH,aAAa,CAAC4D,kBAAnB;AACE,aAAO,EACL,GAAGzD,KADE;AAELK,QAAAA,YAAY,EAAE;AAFT,OAAP;;AAIF,SAAKR,aAAa,CAAC6D,mBAAnB;AACE,aAAO,EACL,GAAG1D,KADE;AAELK,QAAAA,YAAY,EAAE;AAFT,OAAP;;AAIF,SAAKR,aAAa,CAAC8D,oBAAnB;AACE,aAAO,EACL,GAAG3D,KADE;AAELM,QAAAA,cAAc,EAAE,EACd,GAAGN,KAAK,CAACM,cADK;AAEdC,UAAAA,MAAM,EAAE,IAFM;AAGdqD,UAAAA,MAAM,EAAE,EACN,GAAG5D,KAAK,CAAC4D,MADH;AAEN,eAAGnD,MAAM,CAACmB,IAAP,CAAYgC;AAFT,WAHM;AAOdC,UAAAA,MAAM,EAAE,EACN,GAAG7D,KAAK,CAAC6D,MADH;AAEN,eAAGpD,MAAM,CAACmB,IAAP,CAAYiC;AAFT,WAPM;AAWd7C,UAAAA,IAAI,EAAE,EACJ,GAAGhB,KAAK,CAACgB,IADL;AAEJ,eAAGP,MAAM,CAACmB,IAAP,CAAYZ;AAFX;AAXQ;AAFX,OAAP;;AAmBF,SAAKnB,aAAa,CAACiE,qBAAnB;AACE,aAAO,EACL,GAAG9D,KADE;AAELM,QAAAA,cAAc,EAAE,EACd,GAAGN,KAAK,CAACM,cADK;AAEdC,UAAAA,MAAM,EAAE,KAFM;AAGdqD,UAAAA,MAAM,EAAE,EAHM;AAIdC,UAAAA,MAAM,EAAE,EAJM;AAKd7C,UAAAA,IAAI,EAAE;AALQ;AAFX,OAAP;;AAUF,SAAKnB,aAAa,CAACkE,YAAnB;AACE,aAAO,EACL,GAAG/D,KADE;AAELQ,QAAAA,aAAa,EAAEC,MAAM,CAACR;AAFjB,OAAP;;AAIF;AACE,aAAOD,KAAP;AA/VJ;AAiWD","sourcesContent":["import { chatConstants } from \"../constants/chat.constants\";\r\nimport { chatService } from \"../services/chat.service\";\r\n\r\nexport function chat(\r\n  state = {\r\n    rooms: [],\r\n    currentRoom: null,\r\n    roomsFetching: false,\r\n    roomId: null,\r\n    callingModal: false,\r\n    answeringModal: {\r\n      isOpen: false,\r\n    },\r\n    searchedRooms: null,\r\n  },\r\n  action\r\n) {\r\n  switch (action.type) {\r\n    case chatConstants.TYPING:\r\n      if (state[action.roomId]) {\r\n        return {\r\n          ...state,\r\n          [action.roomId]: {\r\n            ...state[action.roomId],\r\n            isTyping: true,\r\n          },\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n    case chatConstants.STOPPED_TYPING:\r\n      if (state[action.roomId]) {\r\n        return {\r\n          ...state,\r\n          [action.roomId]: {\r\n            ...state[action.roomId],\r\n            isTyping: false,\r\n          },\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n    case chatConstants.CHANGE_ROOM:\r\n      if (action.clearRoom != null && action.clearRoom != action.room._id) state[action.clearRoom].messages = [];\r\n\r\n      return {\r\n        ...state,\r\n        currentRoom: action.room,\r\n        roomId: action.room._id,\r\n      };\r\n    case chatConstants.INIT_MESSAGE_ARRAY:\r\n      if (!state[action.roomId]) {\r\n        return {\r\n          ...state,\r\n          [action.roomId]: {\r\n            messages: [],\r\n            initialMessagesFetchig: false,\r\n            messageFetching: false,\r\n            isTyping: false,\r\n          },\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n\r\n    case chatConstants.GET_ROOMS_REQUEST:\r\n      return {\r\n        ...state,\r\n        roomsFetching: true,\r\n      };\r\n    case chatConstants.GET_ROOMS_SUCCESS:\r\n      return {\r\n        ...state,\r\n        rooms: action.rooms,\r\n        roomsFetching: false,\r\n      };\r\n    case chatConstants.ADD_NEW_ROOM:\r\n      return {\r\n        ...state,\r\n        rooms: [action.room, ...state.rooms],\r\n      };\r\n    case chatConstants.GET_MESSAGES_INITIAL_REQUEST:\r\n      return {\r\n        ...state,\r\n        [action.roomId]: {\r\n          ...state[action.roomId],\r\n          initialMessagesFetchig: true,\r\n        },\r\n      };\r\n    case chatConstants.GET_MESSAGES_REQUEST:\r\n      return {\r\n        ...state,\r\n        [action.roomId]: {\r\n          ...state[action.roomId],\r\n          messageFetching: true,\r\n        },\r\n      };\r\n    case chatConstants.GET_MESSAGES_SUCCESS:\r\n      let messages = action.data.messages;\r\n      let prev = null;\r\n\r\n      for (let i = 0; i < messages.length; i++) {\r\n        if (prev !== messages[i].sender) {\r\n          messages[i].picture = true;\r\n          prev = messages[i].sender;\r\n        } else {\r\n          messages[i].picture = false;\r\n        }\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        [action.data.roomId]: {\r\n          ...state[action.data.roomId],\r\n          messages: [\r\n            ...action.data.messages,\r\n            ...state[action.data.roomId].messages,\r\n          ],\r\n          messageFetching: false,\r\n          initialMessagesFetchig: false,\r\n        },\r\n      };\r\n    case chatConstants.SEND_MESSAGE_REQUEST:\r\n      let currentRoom = state.currentRoom;\r\n      if (currentRoom && state.currentRoom._id === action.message.roomId) {\r\n        currentRoom = {\r\n          ...state.currentRoom,\r\n          messages: state.currentRoom.messages + 1,\r\n        };\r\n      }\r\n\r\n      if (state[action.message.roomId]) {\r\n        const messages = state[action.message.roomId].messages;\r\n        if (!messages.length) action.message.picture = true;\r\n        else if (messages[messages.length - 1].sender !== action.message.sender)\r\n          action.message.picture = true;\r\n        else action.message.picture = false;\r\n        console.log(state[action.message.roomId].messages);\r\n        return {\r\n          ...state,\r\n          [action.message.roomId]: {\r\n            ...state[action.message.roomId],\r\n            messages: [\r\n              ...state[action.message.roomId].messages,\r\n              action.message,\r\n            ],\r\n          },\r\n          rooms: state.rooms.map((room) => {\r\n            if (room._id === action.message.roomId) {\r\n              return {\r\n                ...room,\r\n                messages: room.messages + 1,\r\n              };\r\n            } else {\r\n              return room;\r\n            }\r\n          }),\r\n          currentRoom,\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n    case chatConstants.SEND_MESSAGE_SUCCESS:\r\n      if (state[action.message.roomId]) {\r\n        const index = state.rooms.findIndex(\r\n          (room) => room._id === action.message.roomId\r\n        );\r\n        const newRoom = state.rooms[index];\r\n\r\n        const messages = state[action.message.roomId].messages;\r\n        if (messages.length <= 1) action.message.picture = true;\r\n        else if (messages[messages.length - 2].sender !== action.message.sender)\r\n          action.message.picture = true;\r\n        else action.message.picture = false;\r\n\r\n        return {\r\n          ...state,\r\n          [action.message.roomId]: {\r\n            ...state[action.message.roomId],\r\n            messages: state[action.message.roomId].messages.map((message) => {\r\n              if (message.uuid !== action.message.uuid) {\r\n                return action.message;\r\n              } else {\r\n                return message;\r\n              }\r\n            }),\r\n          },\r\n          rooms: [\r\n            {\r\n              ...newRoom,\r\n              //messages: newRoom.messages + 1,\r\n              lastMessage: action.message,\r\n            },\r\n            ...state.rooms.filter((room) => room._id !== action.message.roomId),\r\n          ],\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n    case chatConstants.NEW_MESSAGE:\r\n      if (state[action.message.roomId]) {\r\n        const index = state.rooms.findIndex(\r\n          (room) => room._id === action.message.roomId\r\n        );\r\n        const newRoom = state.rooms[index];\r\n\r\n        const messages = state[action.message.roomId].messages;\r\n        if (!messages.length) action.message.picture = true;\r\n        else if (messages[messages.length - 1].sender !== action.message.sender)\r\n          action.message.picture = true;\r\n        else action.message.picture = false;\r\n\r\n        let currentRoom = state.currentRoom;\r\n        if (currentRoom && state.currentRoom._id !== action.message.roomId) {\r\n          chatService.readMessages({ roomId: action.message.roomId, messageIds: [action.message._id] });\r\n          currentRoom = {\r\n            ...state.currentRoom,\r\n            messages: state.currentRoom.messages + 1,\r\n          };\r\n        } else {\r\n          action.message.read = true\r\n        }\r\n        return {\r\n          ...state,\r\n          [action.message.roomId]: {\r\n            ...state[action.message.roomId],\r\n            messages: [\r\n              ...state[action.message.roomId].messages,\r\n              action.message,\r\n            ],\r\n          },\r\n          currentRoom,\r\n          rooms: [\r\n            {\r\n              ...newRoom,\r\n              messages: newRoom.messages + 1,\r\n              lastMessage: action.message,\r\n            },\r\n            ...state.rooms.filter((room) => room._id !== action.message.roomId),\r\n          ],\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n    case chatConstants.READ_MESSAGES:\r\n      return {\r\n        ...state,\r\n        [action.roomId]: {\r\n          ...state[action.roomId],\r\n          messages: state[action.roomId].messages.map((message) => {\r\n            if (action.messageIds.includes(message._id)) {\r\n              return {\r\n                ...message,\r\n                read: true,\r\n              };\r\n            } else {\r\n              return {\r\n                ...message,\r\n              };\r\n            }\r\n          }),\r\n        },\r\n      };\r\n    case chatConstants.CHANGE_ACTIVITY_STATUS:\r\n      return {\r\n        ...state,\r\n        rooms: state.rooms.map((room) => {\r\n          if (room.members[0]._id === action.user.user) {\r\n            room.members[0].active = action.user.active;\r\n            return {\r\n              ...room,\r\n            };\r\n          } else if (room.members[1]._id === action.user.user) {\r\n            room.members[1].active = action.user.active;\r\n            return {\r\n              ...room,\r\n            };\r\n          } else {\r\n            return {\r\n              ...room,\r\n            };\r\n          }\r\n        }),\r\n      };\r\n    case chatConstants.RECEIVE_READ_MESSAGES:\r\n      if (state[action.data.roomId]) {\r\n        return {\r\n          ...state,\r\n          [action.data.roomId]: {\r\n            ...state[action.data.roomId],\r\n            messages: state[action.data.roomId].messages.map((message) => {\r\n              if (action.data.messageIds.includes(message._id)) {\r\n                return {\r\n                  ...message,\r\n                  read: true,\r\n                };\r\n              } else {\r\n                return {\r\n                  ...message,\r\n                };\r\n              }\r\n            }),\r\n          },\r\n        };\r\n      } else {\r\n        return {\r\n          ...state,\r\n        };\r\n      }\r\n    case chatConstants.OPEN_CALLING_MODAL:\r\n      return {\r\n        ...state,\r\n        callingModal: true,\r\n      };\r\n    case chatConstants.CLOSE_CALLING_MODAL:\r\n      return {\r\n        ...state,\r\n        callingModal: false,\r\n      };\r\n    case chatConstants.OPEN_ANSWERING_MODAL:\r\n      return {\r\n        ...state,\r\n        answeringModal: {\r\n          ...state.answeringModal,\r\n          isOpen: true,\r\n          webRtc: {\r\n            ...state.webRtc,\r\n            ...action.data.webRtc,\r\n          },\r\n          caller: {\r\n            ...state.caller,\r\n            ...action.data.caller,\r\n          },\r\n          room: {\r\n            ...state.room,\r\n            ...action.data.room,\r\n          },\r\n        },\r\n      };\r\n    case chatConstants.CLOSE_ANSWERING_MODAL:\r\n      return {\r\n        ...state,\r\n        answeringModal: {\r\n          ...state.answeringModal,\r\n          isOpen: false,\r\n          webRtc: {},\r\n          caller: {},\r\n          room: {},\r\n        },\r\n      };\r\n    case chatConstants.SEARCH_USERS:\r\n      return {\r\n        ...state,\r\n        searchedRooms: action.rooms,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}