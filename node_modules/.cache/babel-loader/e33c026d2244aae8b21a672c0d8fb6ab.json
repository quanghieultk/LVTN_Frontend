{"ast":null,"code":"import { chatConstants } from \"../constants/chat.constants\";\nexport function chat(state = {\n  rooms: [],\n  currentRoom: null,\n  roomsFetching: false,\n  roomId: null,\n  callingModal: false,\n  answeringModal: {\n    isOpen: false\n  },\n  searchedRooms: null\n}, action) {\n  switch (action.type) {\n    case chatConstants.TYPING:\n      if (state[action.roomId]) {\n        return { ...state,\n          [action.roomId]: { ...state[action.roomId],\n            isTyping: true\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.STOPPED_TYPING:\n      if (state[action.roomId]) {\n        return { ...state,\n          [action.roomId]: { ...state[action.roomId],\n            isTyping: false\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.CHANGE_ROOM:\n      return { ...state,\n        currentRoom: action.room,\n        roomId: action.room._id\n      };\n\n    case chatConstants.INIT_MESSAGE_ARRAY:\n      if (!state[action.roomId]) {\n        return { ...state,\n          [action.roomId]: {\n            messages: [],\n            initialMessagesFetchig: false,\n            messageFetching: false,\n            isTyping: false\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.GET_ROOMS_REQUEST:\n      return { ...state,\n        roomsFetching: true\n      };\n\n    case chatConstants.GET_ROOMS_SUCCESS:\n      return { ...state,\n        rooms: action.rooms,\n        roomsFetching: false\n      };\n\n    case chatConstants.ADD_NEW_ROOM:\n      return { ...state,\n        rooms: [action.room, ...state.rooms]\n      };\n\n    case chatConstants.GET_MESSAGES_INITIAL_REQUEST:\n      return { ...state,\n        [action.roomId]: { ...state[action.roomId],\n          initialMessagesFetchig: true\n        }\n      };\n\n    case chatConstants.GET_MESSAGES_REQUEST:\n      return { ...state,\n        [action.roomId]: { ...state[action.roomId],\n          messageFetching: true\n        }\n      };\n\n    case chatConstants.GET_MESSAGES_SUCCESS:\n      let messages = action.data.messages;\n      let prev = null;\n\n      for (let i = 0; i < messages.length; i++) {\n        if (prev !== messages[i].sender) {\n          messages[i].picture = true;\n          prev = messages[i].sender;\n        } else {\n          messages[i].picture = false;\n        }\n      }\n\n      return { ...state,\n        [action.data.roomId]: { ...state[action.data.roomId],\n          messages: [...action.data.messages, ...state[action.data.roomId].messages],\n          messageFetching: false,\n          initialMessagesFetchig: false\n        }\n      };\n\n    case chatConstants.SEND_MESSAGE_REQUEST:\n      let currentRoom = state.currentRoom;\n\n      if (currentRoom && state.currentRoom._id === action.message.roomId) {\n        currentRoom = { ...state.currentRoom,\n          messages: state.currentRoom.messages + 1\n        };\n      }\n\n      if (state[action.message.roomId]) {\n        const messages = state[action.message.roomId].messages;\n        if (!messages.length) action.message.picture = true;else if (messages[messages.length - 1].sender !== action.message.sender) action.message.picture = true;else action.message.picture = false;\n        return { ...state,\n          [action.message.roomId]: { ...state[action.message.roomId],\n            messages: [...state[action.message.roomId].messages, action.message]\n          },\n          rooms: state.rooms.map(room => {\n            if (room._id === action.message.roomId) {\n              return { ...room,\n                messages: room.messages + 1\n              };\n            } else {\n              return room;\n            }\n          }),\n          currentRoom\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.SEND_MESSAGE_SUCCESS:\n      if (state[action.message.roomId]) {\n        const index = state.rooms.findIndex(room => room._id === action.message.roomId);\n        const newRoom = state.rooms[index];\n        const messages = state[action.message.roomId].messages;\n        if (messages.length <= 1) action.message.picture = true;else if (messages[messages.length - 2].sender !== action.message.sender) action.message.picture = true;else action.message.picture = false;\n        return { ...state,\n          [action.message.roomId]: { ...state[action.message.roomId],\n            messages: state[action.message.roomId].messages.map(message => {\n              if (message.uuid === action.message.uuid) {\n                return action.message;\n              } else {\n                return message;\n              }\n            })\n          },\n          rooms: [{ ...newRoom,\n            //messages: newRoom.messages + 1,\n            lastMessage: [action.message]\n          }, ...state.rooms.filter(room => room._id !== action.message.roomId)]\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.NEW_MESSAGE:\n      if (state[action.message.roomId]) {\n        const index = state.rooms.findIndex(room => room._id === action.message.roomId);\n        const newRoom = state.rooms[index];\n        const messages = state[action.message.roomId].messages;\n        if (!messages.length) action.message.picture = true;else if (messages[messages.length - 1].sender !== action.message.sender) action.message.picture = true;else action.message.picture = false;\n        let currentRoom = state.currentRoom;\n\n        if (currentRoom && state.currentRoom._id === action.message.roomId) {\n          currentRoom = { ...state.currentRoom,\n            messages: state.currentRoom.messages + 1\n          };\n        }\n\n        return { ...state,\n          [action.message.roomId]: { ...state[action.message.roomId],\n            messages: [...state[action.message.roomId].messages, action.message]\n          },\n          currentRoom,\n          rooms: [{ ...newRoom,\n            messages: newRoom.messages + 1,\n            lastMessage: [action.message]\n          }, ...state.rooms.filter(room => room._id !== action.message.roomId)]\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.READ_MESSAGES:\n      return { ...state,\n        [action.roomId]: { ...state[action.roomId],\n          messages: state[action.roomId].messages.map(message => {\n            if (action.messageIds.includes(message._id)) {\n              return { ...message,\n                read: true\n              };\n            } else {\n              return { ...message\n              };\n            }\n          })\n        }\n      };\n\n    case chatConstants.CHANGE_ACTIVITY_STATUS:\n      return { ...state,\n        rooms: state.rooms.map(room => {\n          if (room.members[0]._id === action.user.user) {\n            room.members[0].activityStatus = action.user.activityStatus;\n            return { ...room\n            };\n          } else if (room.members[1]._id === action.user.user) {\n            room.members[1].activityStatus = action.user.activityStatus;\n            return { ...room\n            };\n          } else {\n            return { ...room\n            };\n          }\n        })\n      };\n\n    case chatConstants.RECEIVE_READ_MESSAGES:\n      if (state[action.data.roomId]) {\n        return { ...state,\n          [action.data.roomId]: { ...state[action.data.roomId],\n            messages: state[action.data.roomId].messages.map(message => {\n              if (action.data.messageIds.includes(message._id)) {\n                return { ...message,\n                  read: true\n                };\n              } else {\n                return { ...message\n                };\n              }\n            })\n          }\n        };\n      } else {\n        return { ...state\n        };\n      }\n\n    case chatConstants.OPEN_CALLING_MODAL:\n      return { ...state,\n        callingModal: true\n      };\n\n    case chatConstants.CLOSE_CALLING_MODAL:\n      return { ...state,\n        callingModal: false\n      };\n\n    case chatConstants.OPEN_ANSWERING_MODAL:\n      return { ...state,\n        answeringModal: { ...state.answeringModal,\n          isOpen: true,\n          webRtc: { ...state.webRtc,\n            ...action.data.webRtc\n          },\n          caller: { ...state.caller,\n            ...action.data.caller\n          },\n          room: { ...state.room,\n            ...action.data.room\n          }\n        }\n      };\n\n    case chatConstants.CLOSE_ANSWERING_MODAL:\n      return { ...state,\n        answeringModal: { ...state.answeringModal,\n          isOpen: false,\n          webRtc: {},\n          caller: {},\n          room: {}\n        }\n      };\n\n    case chatConstants.SEARCH_USERS:\n      return { ...state,\n        searchedRooms: action.rooms\n      };\n\n    default:\n      return state;\n  }\n}","map":{"version":3,"sources":["D:/LVTN/LVTN/cuisine-net/src/reducers/chat.reducer.js"],"names":["chatConstants","chat","state","rooms","currentRoom","roomsFetching","roomId","callingModal","answeringModal","isOpen","searchedRooms","action","type","TYPING","isTyping","STOPPED_TYPING","CHANGE_ROOM","room","_id","INIT_MESSAGE_ARRAY","messages","initialMessagesFetchig","messageFetching","GET_ROOMS_REQUEST","GET_ROOMS_SUCCESS","ADD_NEW_ROOM","GET_MESSAGES_INITIAL_REQUEST","GET_MESSAGES_REQUEST","GET_MESSAGES_SUCCESS","data","prev","i","length","sender","picture","SEND_MESSAGE_REQUEST","message","map","SEND_MESSAGE_SUCCESS","index","findIndex","newRoom","uuid","lastMessage","filter","NEW_MESSAGE","READ_MESSAGES","messageIds","includes","read","CHANGE_ACTIVITY_STATUS","members","user","activityStatus","RECEIVE_READ_MESSAGES","OPEN_CALLING_MODAL","CLOSE_CALLING_MODAL","OPEN_ANSWERING_MODAL","webRtc","caller","CLOSE_ANSWERING_MODAL","SEARCH_USERS"],"mappings":"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","sourcesContent":["import { chatConstants } from \"../constants/chat.constants\";\r\n\r\nexport function chat(\r\n    state = {\r\n      rooms: [],\r\n      currentRoom: null,\r\n      roomsFetching: false,\r\n      roomId: null,\r\n      callingModal: false,\r\n      answeringModal: {\r\n        isOpen: false,\r\n      },\r\n      searchedRooms: null,\r\n    },\r\n    action\r\n  ) {\r\n    switch (action.type) {\r\n      case chatConstants.TYPING:\r\n        if (state[action.roomId]) {\r\n          return {\r\n            ...state,\r\n            [action.roomId]: {\r\n              ...state[action.roomId],\r\n              isTyping: true,\r\n            },\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n      case chatConstants.STOPPED_TYPING:\r\n        if (state[action.roomId]) {\r\n          return {\r\n            ...state,\r\n            [action.roomId]: {\r\n              ...state[action.roomId],\r\n              isTyping: false,\r\n            },\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n      case chatConstants.CHANGE_ROOM:\r\n        return {\r\n          ...state,\r\n          currentRoom: action.room,\r\n          roomId: action.room._id,\r\n        };\r\n      case chatConstants.INIT_MESSAGE_ARRAY:\r\n        if (!state[action.roomId]) {\r\n          return {\r\n            ...state,\r\n            [action.roomId]: {\r\n              messages: [],\r\n              initialMessagesFetchig: false,\r\n              messageFetching: false,\r\n              isTyping: false,\r\n            },\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n  \r\n      case chatConstants.GET_ROOMS_REQUEST:\r\n        return {\r\n          ...state,\r\n          roomsFetching: true,\r\n        };\r\n      case chatConstants.GET_ROOMS_SUCCESS:\r\n        return {\r\n          ...state,\r\n          rooms: action.rooms,\r\n          roomsFetching: false,\r\n        };\r\n      case chatConstants.ADD_NEW_ROOM:\r\n        return {\r\n          ...state,\r\n          rooms: [action.room, ...state.rooms],\r\n        };\r\n      case chatConstants.GET_MESSAGES_INITIAL_REQUEST:\r\n        return {\r\n          ...state,\r\n          [action.roomId]: {\r\n            ...state[action.roomId],\r\n            initialMessagesFetchig: true,\r\n          },\r\n        };\r\n      case chatConstants.GET_MESSAGES_REQUEST:\r\n        return {\r\n          ...state,\r\n          [action.roomId]: {\r\n            ...state[action.roomId],\r\n            messageFetching: true,\r\n          },\r\n        };\r\n      case chatConstants.GET_MESSAGES_SUCCESS:\r\n        let messages = action.data.messages;\r\n        let prev = null;\r\n  \r\n        for (let i = 0; i < messages.length; i++) {\r\n          if (prev !== messages[i].sender) {\r\n            messages[i].picture = true;\r\n            prev = messages[i].sender;\r\n          } else {\r\n            messages[i].picture = false;\r\n          }\r\n        }\r\n  \r\n        return {\r\n          ...state,\r\n          [action.data.roomId]: {\r\n            ...state[action.data.roomId],\r\n            messages: [\r\n              ...action.data.messages,\r\n              ...state[action.data.roomId].messages,\r\n            ],\r\n            messageFetching: false,\r\n            initialMessagesFetchig: false,\r\n          },\r\n        };\r\n      case chatConstants.SEND_MESSAGE_REQUEST:\r\n        let currentRoom = state.currentRoom;\r\n        if (currentRoom && state.currentRoom._id === action.message.roomId) {\r\n          currentRoom = {\r\n            ...state.currentRoom,\r\n            messages: state.currentRoom.messages + 1,\r\n          };\r\n        }\r\n  \r\n        if (state[action.message.roomId]) {\r\n          const messages = state[action.message.roomId].messages;\r\n          if (!messages.length) action.message.picture = true;\r\n          else if (messages[messages.length - 1].sender !== action.message.sender)\r\n            action.message.picture = true;\r\n          else action.message.picture = false;\r\n  \r\n          return {\r\n            ...state,\r\n            [action.message.roomId]: {\r\n              ...state[action.message.roomId],\r\n              messages: [\r\n                ...state[action.message.roomId].messages,\r\n                action.message,\r\n              ],\r\n            },\r\n            rooms: state.rooms.map((room) => {\r\n              if (room._id === action.message.roomId) {\r\n                return {\r\n                  ...room,\r\n                  messages: room.messages + 1,\r\n                };\r\n              } else {\r\n                return room;\r\n              }\r\n            }),\r\n            currentRoom,\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n      case chatConstants.SEND_MESSAGE_SUCCESS:\r\n        if (state[action.message.roomId]) {\r\n          const index = state.rooms.findIndex(\r\n            (room) => room._id === action.message.roomId\r\n          );\r\n          const newRoom = state.rooms[index];\r\n  \r\n          const messages = state[action.message.roomId].messages;\r\n          if (messages.length <= 1) action.message.picture = true;\r\n          else if (messages[messages.length - 2].sender !== action.message.sender)\r\n            action.message.picture = true;\r\n          else action.message.picture = false;\r\n  \r\n          return {\r\n            ...state,\r\n            [action.message.roomId]: {\r\n              ...state[action.message.roomId],\r\n              messages: state[action.message.roomId].messages.map((message) => {\r\n                if (message.uuid === action.message.uuid) {\r\n                  return action.message;\r\n                } else {\r\n                  return message;\r\n                }\r\n              }),\r\n            },\r\n            rooms: [\r\n              {\r\n                ...newRoom,\r\n                //messages: newRoom.messages + 1,\r\n                lastMessage: [action.message],\r\n              },\r\n              ...state.rooms.filter((room) => room._id !== action.message.roomId),\r\n            ],\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n      case chatConstants.NEW_MESSAGE:\r\n        if (state[action.message.roomId]) {\r\n          const index = state.rooms.findIndex(\r\n            (room) => room._id === action.message.roomId\r\n          );\r\n          const newRoom = state.rooms[index];\r\n  \r\n          const messages = state[action.message.roomId].messages;\r\n          if (!messages.length) action.message.picture = true;\r\n          else if (messages[messages.length - 1].sender !== action.message.sender)\r\n            action.message.picture = true;\r\n          else action.message.picture = false;\r\n  \r\n          let currentRoom = state.currentRoom;\r\n          if (currentRoom && state.currentRoom._id === action.message.roomId) {\r\n            currentRoom = {\r\n              ...state.currentRoom,\r\n              messages: state.currentRoom.messages + 1,\r\n            };\r\n          }\r\n          return {\r\n            ...state,\r\n            [action.message.roomId]: {\r\n              ...state[action.message.roomId],\r\n              messages: [\r\n                ...state[action.message.roomId].messages,\r\n                action.message,\r\n              ],\r\n            },\r\n            currentRoom,\r\n            rooms: [\r\n              {\r\n                ...newRoom,\r\n                messages: newRoom.messages + 1,\r\n                lastMessage: [action.message],\r\n              },\r\n              ...state.rooms.filter((room) => room._id !== action.message.roomId),\r\n            ],\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n      case chatConstants.READ_MESSAGES:\r\n        return {\r\n          ...state,\r\n          [action.roomId]: {\r\n            ...state[action.roomId],\r\n            messages: state[action.roomId].messages.map((message) => {\r\n              if (action.messageIds.includes(message._id)) {\r\n                return {\r\n                  ...message,\r\n                  read: true,\r\n                };\r\n              } else {\r\n                return {\r\n                  ...message,\r\n                };\r\n              }\r\n            }),\r\n          },\r\n        };\r\n      case chatConstants.CHANGE_ACTIVITY_STATUS:\r\n        return {\r\n          ...state,\r\n          rooms: state.rooms.map((room) => {\r\n            if (room.members[0]._id === action.user.user) {\r\n              room.members[0].activityStatus = action.user.activityStatus;\r\n              return {\r\n                ...room,\r\n              };\r\n            } else if (room.members[1]._id === action.user.user) {\r\n              room.members[1].activityStatus = action.user.activityStatus;\r\n              return {\r\n                ...room,\r\n              };\r\n            } else {\r\n              return {\r\n                ...room,\r\n              };\r\n            }\r\n          }),\r\n        };\r\n      case chatConstants.RECEIVE_READ_MESSAGES:\r\n        if (state[action.data.roomId]) {\r\n          return {\r\n            ...state,\r\n            [action.data.roomId]: {\r\n              ...state[action.data.roomId],\r\n              messages: state[action.data.roomId].messages.map((message) => {\r\n                if (action.data.messageIds.includes(message._id)) {\r\n                  return {\r\n                    ...message,\r\n                    read: true,\r\n                  };\r\n                } else {\r\n                  return {\r\n                    ...message,\r\n                  };\r\n                }\r\n              }),\r\n            },\r\n          };\r\n        } else {\r\n          return {\r\n            ...state,\r\n          };\r\n        }\r\n      case chatConstants.OPEN_CALLING_MODAL:\r\n        return {\r\n          ...state,\r\n          callingModal: true,\r\n        };\r\n      case chatConstants.CLOSE_CALLING_MODAL:\r\n        return {\r\n          ...state,\r\n          callingModal: false,\r\n        };\r\n      case chatConstants.OPEN_ANSWERING_MODAL:\r\n        return {\r\n          ...state,\r\n          answeringModal: {\r\n            ...state.answeringModal,\r\n            isOpen: true,\r\n            webRtc: {\r\n              ...state.webRtc,\r\n              ...action.data.webRtc,\r\n            },\r\n            caller: {\r\n              ...state.caller,\r\n              ...action.data.caller,\r\n            },\r\n            room: {\r\n              ...state.room,\r\n              ...action.data.room,\r\n            },\r\n          },\r\n        };\r\n      case chatConstants.CLOSE_ANSWERING_MODAL:\r\n        return {\r\n          ...state,\r\n          answeringModal: {\r\n            ...state.answeringModal,\r\n            isOpen: false,\r\n            webRtc: {},\r\n            caller: {},\r\n            room: {},\r\n          },\r\n        };\r\n      case chatConstants.SEARCH_USERS:\r\n        return {\r\n          ...state,\r\n          searchedRooms: action.rooms,\r\n        };\r\n      default:\r\n        return state;\r\n    }\r\n  }"]},"metadata":{},"sourceType":"module"}